<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Customer Feature</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .success { color: #16a34a; font-weight: bold; }
        .error { color: #dc2626; font-weight: bold; }
        button {
            background: #2563eb;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1d4ed8; }
        pre {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
        h2 { color: #1e293b; }
        .status {
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .status.success { background: #dcfce7; }
        .status.error { background: #fee2e2; }
    </style>
</head>
<body>
    <h1>üß™ Customer Feature Test Suite</h1>

    <div class="test-box">
        <h2>Step 1: Check Backend</h2>
        <button onclick="testBackend()">Test Backend Connection</button>
        <div id="backend-result"></div>
    </div>

    <div class="test-box">
        <h2>Step 2: Add Test Customer to Database</h2>
        <p>This will add sample customers to test autocomplete:</p>
        <button onclick="showSQLScript()">Show SQL Script</button>
        <div id="sql-script" style="display:none;">
            <p><strong>Copy this and run in Supabase SQL Editor:</strong></p>
            <pre>INSERT INTO customer_history (customer_name, customer_phone, total_orders, total_spent)
VALUES
  ('John Doe', '+254712345678', 8, 15000),
  ('Jane Smith', '+254723456789', 12, 25000),
  ('Michael Chen', '+254734567890', 3, 4500),
  ('Sarah Wilson', '+254745678901', 15, 35000),
  ('David Brown', '+254756789012', 1, 1200)
ON CONFLICT (customer_phone) DO NOTHING;</pre>
            <button onclick="markCustomersAdded()">‚úÖ I Added the Customers</button>
        </div>
        <div id="customers-status"></div>
    </div>

    <div class="test-box">
        <h2>Step 3: Clear Browser Cache</h2>
        <p><strong>Do this manually:</strong></p>
        <ol>
            <li>Press <code>Ctrl+Shift+Delete</code></li>
            <li>Select "All time"</li>
            <li>Check "Cookies" and "Cached images"</li>
            <li>Click "Clear data"</li>
        </ol>
        <button onclick="markCacheCleared()">‚úÖ I Cleared the Cache</button>
        <div id="cache-status"></div>
    </div>

    <div class="test-box">
        <h2>Step 4: Test the App</h2>
        <button onclick="openApp()">üöÄ Open App in New Tab</button>
        <div style="margin-top: 20px;">
            <h3>Testing Checklist:</h3>
            <ol>
                <li>‚úÖ Login as waiter/admin</li>
                <li>‚úÖ Go to menu page</li>
                <li>‚úÖ Add some items to cart</li>
                <li>‚úÖ Click "Checkout"</li>
                <li>‚úÖ In the dialog, start typing "Joh" in customer name</li>
                <li>‚úÖ You should see "John Doe" appear in dropdown!</li>
                <li>‚úÖ Click on it - fields auto-populate!</li>
                <li>‚úÖ Type phone "0723456789" - name auto-fills "Jane Smith"!</li>
            </ol>
        </div>
    </div>

    <div class="test-box">
        <h2>üìä Final Status</h2>
        <div id="final-status"></div>
    </div>

    <script>
        async function testBackend() {
            const result = document.getElementById('backend-result');
            result.innerHTML = '<p>Testing backend...</p>';

            try {
                const response = await fetch('http://localhost:8000/docs');
                if (response.ok) {
                    result.innerHTML = '<div class="status success">‚úÖ Backend is running on port 8000!</div>';
                    updateFinalStatus('backend', true);
                } else {
                    result.innerHTML = '<div class="status error">‚ùå Backend returned error: ' + response.status + '</div>';
                    updateFinalStatus('backend', false);
                }
            } catch (error) {
                result.innerHTML = '<div class="status error">‚ùå Cannot connect to backend. Make sure it\'s running on port 8000.</div>';
                updateFinalStatus('backend', false);
            }
        }

        function showSQLScript() {
            document.getElementById('sql-script').style.display = 'block';
        }

        function markCustomersAdded() {
            const status = document.getElementById('customers-status');
            status.innerHTML = '<div class="status success">‚úÖ Test customers added to database!</div>';
            updateFinalStatus('customers', true);
        }

        function markCacheCleared() {
            const status = document.getElementById('cache-status');
            status.innerHTML = '<div class="status success">‚úÖ Browser cache cleared!</div>';
            updateFinalStatus('cache', true);
        }

        function openApp() {
            window.open('http://localhost:5173', '_blank');
            updateFinalStatus('tested', true);
        }

        const status = {
            backend: false,
            customers: false,
            cache: false,
            tested: false
        };

        function updateFinalStatus(key, value) {
            status[key] = value;
            const finalStatus = document.getElementById('final-status');

            const allDone = Object.values(status).every(v => v === true);

            if (allDone) {
                finalStatus.innerHTML = `
                    <div class="status success">
                        <h3>üéâ ALL TESTS COMPLETE!</h3>
                        <p>The customer auto-population feature is ready!</p>
                        <ul>
                            <li>‚úÖ Backend running with correct auth</li>
                            <li>‚úÖ Database has test customers</li>
                            <li>‚úÖ Browser cache cleared</li>
                            <li>‚úÖ App tested</li>
                        </ul>
                        <p><strong>You should now be able to:</strong></p>
                        <ul>
                            <li>üîç Search customers by name (autocomplete)</li>
                            <li>üì± Auto-populate name when entering phone</li>
                            <li>‚≠ê See VIP badges for frequent customers</li>
                            <li>üö´ NOT get logged out when typing!</li>
                        </ul>
                    </div>
                `;
            } else {
                const done = Object.entries(status).filter(([k,v]) => v).map(([k]) => k);
                const pending = Object.entries(status).filter(([k,v]) => !v).map(([k]) => k);

                finalStatus.innerHTML = `
                    <p><strong>Progress:</strong></p>
                    <p>‚úÖ Done: ${done.join(', ') || 'None yet'}</p>
                    <p>‚è≥ Pending: ${pending.join(', ')}</p>
                `;
            }
        }

        // Initial status check
        updateFinalStatus('none', false);
    </script>
</body>
</html>
