<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manager Dashboard Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .status-card {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status-loading { border-left: 4px solid #007bff; }
        .status-success { border-left: 4px solid #28a745; }
        .status-error { border-left: 4px solid #dc3545; }
        .log {
            background: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Manager Dashboard Data Loading Test</h1>
        <p>This test verifies that all dashboard data hooks are working correctly.</p>
        
        <div id="status-display"></div>
        
        <div class="log" id="log-display"></div>
        
        <div style="margin-top: 20px;">
            <button onclick="testAllHooks()">Test All Hooks</button>
            <button onclick="clearLog()">Clear Log</button>
        </div>
    </div>

    <script>
        let logMessages = [];
        
        function log(message) {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}`;
            logMessages.push(logEntry);
            
            const logDisplay = document.getElementById('log-display');
            logDisplay.innerHTML = logMessages.join('<br>');
            logDisplay.scrollTop = logDisplay.scrollHeight;
            
            console.log(logEntry);
        }

        function updateStatus(hook, status, details = '') {
            const statusDisplay = document.getElementById('status-display');
            const statusClass = status === 'loading' ? 'status-loading' : 
                               status === 'success' ? 'status-success' : 'status-error';
            
            let statusHtml = `<div class="status-card ${statusClass}">
                <strong>${hook}</strong>: ${status.toUpperCase()}
                ${details ? `<br><small>${details}</small>` : ''}
            </div>`;
            
            statusDisplay.innerHTML += statusHtml;
        }

        async function testHook(hookName, testFunction) {
            updateStatus(hookName, 'loading');
            log(`Testing ${hookName}...`);
            
            try {
                const result = await testFunction();
                updateStatus(hookName, 'success', `Data loaded: ${JSON.stringify(result).substring(0, 100)}...`);
                log(`${hookName} test passed: ${JSON.stringify(result).substring(0, 100)}...`);
                return true;
            } catch (error) {
                updateStatus(hookName, 'error', error.message);
                log(`${hookName} test failed: ${error.message}`);
                return false;
            }
        }

        async function testAllHooks() {
            log('Starting dashboard data loading tests...');
            document.getElementById('status-display').innerHTML = '';
            
            const tests = [
                {
                    name: 'Staff Stats',
                    test: async () => {
                        // Test admin API
                        const response = await fetch('http://localhost:8000/api/v1/admin/users?skip=0&limit=10');
                        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        const data = await response.json();
                        return { totalUsers: data.length };
                    }
                },
                {
                    name: 'Revenue Stats',
                    test: async () => {
                        // Test analytics endpoint
                        const response = await fetch('http://localhost:8000/api/v1/analytics/revenue');
                        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        const data = await response.json();
                        return { revenue: data };
                    }
                },
                {
                    name: 'Orders API',
                    test: async () => {
                        // Test orders endpoint
                        const response = await fetch('http://localhost:8000/api/v1/orders?skip=0&limit=10');
                        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        const data = await response.json();
                        return { ordersCount: data.length };
                    }
                },
                {
                    name: 'Rooms API',
                    test: async () => {
                        // Test rooms endpoint
                        const response = await fetch('http://localhost:8000/api/v1/rooms');
                        if (!response.ok) throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                        const data = await response.json();
                        return { roomsCount: data.length };
                    }
                }
            ];

            let passed = 0;
            let total = tests.length;

            for (const test of tests) {
                const success = await testHook(test.name, test.test);
                if (success) passed++;
            }

            log(`Tests completed: ${passed}/${total} passed`);
            updateStatus('Test Summary', passed === total ? 'success' : 'error', 
                        `${passed}/${total} tests passed`);
        }

        function clearLog() {
            logMessages = [];
            document.getElementById('log-display').innerHTML = '';
        }

        // Auto-run tests on page load
        window.onload = () => {
            log('Page loaded. Backend server should be running on http://localhost:8000');
            log('Frontend server should be running on http://localhost:5175');
            log('Click "Test All Hooks" to verify dashboard data loading.');
        };
    </script>
</body>
</html>